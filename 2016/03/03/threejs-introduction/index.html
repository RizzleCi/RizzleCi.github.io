<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>threejs入门 | cxy的个人博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="baidu-site-verification" content="2Ztyf0WNW9">
  <meta name="description" content="本文是一篇简单的webGL+threejs构建web三维视图的入门教程，你可以了解到利用threejs创建简单的三维图形，并且控制图形运动。若有不足，欢迎指出。本文使用的框架是three.jsgithub地址：https://github.com/mrdoob/three.js，官网：http://threejs.org/，文档：http://threejs.org/docs/， 本文中的示例已上">
<meta name="keywords" content="javascript,threejs">
<meta property="og:type" content="article">
<meta property="og:title" content="threejs入门">
<meta property="og:url" content="http://rizzleci.github.io/2016/03/03/threejs-introduction/index.html">
<meta property="og:site_name" content="cxy的个人博客">
<meta property="og:description" content="本文是一篇简单的webGL+threejs构建web三维视图的入门教程，你可以了解到利用threejs创建简单的三维图形，并且控制图形运动。若有不足，欢迎指出。本文使用的框架是three.jsgithub地址：https://github.com/mrdoob/three.js，官网：http://threejs.org/，文档：http://threejs.org/docs/， 本文中的示例已上">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-04-14T11:22:13.258Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="threejs入门">
<meta name="twitter:description" content="本文是一篇简单的webGL+threejs构建web三维视图的入门教程，你可以了解到利用threejs创建简单的三维图形，并且控制图形运动。若有不足，欢迎指出。本文使用的框架是three.jsgithub地址：https://github.com/mrdoob/three.js，官网：http://threejs.org/，文档：http://threejs.org/docs/， 本文中的示例已上">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>
</html>
<body>
  <div id="container">
    <a href="https://github.com/RizzleCi" style="position:absolute; right: 0;display: block;width: 100px;z-index: 2;">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png">
    </a>
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">cxy的个人博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/wwwwhat">随笔</a>
        
      </nav>
      <!-- <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav> -->
      <!-- <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://rizzleci.github.io"></form>
      </div> -->
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-threejs-introduction" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/03/threejs-introduction/" class="article-date">
  <time datetime="2016-03-03T11:39:36.000Z" itemprop="datePublished">2016-03-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      threejs入门
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文是一篇简单的webGL+threejs构建web三维视图的入门教程，你可以了解到利用threejs创建简单的三维图形，并且控制图形运动。若有不足，欢迎指出。<br>本文使用的框架是three.js<br>github地址：<a href="https://github.com/mrdoob/three.js" target="_blank" rel="noopener">https://github.com/mrdoob/three.js</a>，<br>官网：<a href="http://threejs.org/" target="_blank" rel="noopener">http://threejs.org/</a>，<br>文档：<a href="http://threejs.org/docs/" target="_blank" rel="noopener">http://threejs.org/docs/</a>，</p>
<p>本文中的示例已上传github，地址：<a href="https://github.com/RizzleCi/three.js-demo" target="_blank" rel="noopener">https://github.com/RizzleCi/three.js-demo</a></p>
<h2 id="一、创建场景"><a href="#一、创建场景" class="headerlink" title="一、创建场景"></a>一、创建场景</h2><p>我们所见的视图由两个部分共同创建，scene和camera。<br>首先定义一个场景：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scene = <span class="keyword">new</span> THREE.Scene();</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>然后定义一个相机：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera( <span class="number">90</span>, width/height, <span class="number">0.1</span>, <span class="number">1000</span> );</span><br></pre></td></tr></table></figure>
<p>等等，定义相机需要视窗的长宽。现在我要让我的绘图显示在页面的一个区域（<div>)标签中。我们来选中这个元素，获取它的长宽。</div></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'canvasdiv'</span>);</span><br><span class="line"><span class="keyword">var</span> width = canvasdiv.clientWidth;</span><br><span class="line"><span class="keyword">var</span> height = canvasdiv.clientHeight;</span><br></pre></td></tr></table></figure>
<p>这样再加上前面的一行代码，我们就完成了对相机的定义。然后把相机位置设定在z轴上方便观察。<br>camera.position.set(0,0,10)</p>
<p>现在我们需要一个渲染器把定义好的场景渲染出来。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> renderer = <span class="keyword">new</span> THREE.WebGLRenderer();</span><br></pre></td></tr></table></figure>
<p>给这个渲染器合适的大小。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">renderer.setSize( width, height );</span><br></pre></td></tr></table></figure>
<p>然后将其加入到dom中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">canvasdiv.appendChild( renderer.domElement );</span><br></pre></td></tr></table></figure>
<p>（运行以后发现这其实就是一个canvas元素。其实我们也可以在html中创建canvas元素再将renderer绑定到它上面。<code>var renderer = new THREE.WebGLRenderer({ canvas: document.getElementById(&#39;mainCanvas&#39;) });</code>）<br>最后进行渲染。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">renderer.render(scene,camera);</span><br></pre></td></tr></table></figure>
<p>这样，就建立了一个简单的3d场景。</p>
<h2 id="二、绘制图形"><a href="#二、绘制图形" class="headerlink" title="二、绘制图形"></a>二、绘制图形</h2><p>我将threejs中的物体理解为模型+材料。以一个长方体为例。<br>创建模型：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> geometry = <span class="keyword">new</span> THREE.BoxGeometry( <span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span> );</span><br></pre></td></tr></table></figure>
<p>定义材料：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> material = <span class="keyword">new</span> THREE.MeshBasicMaterial( &#123; <span class="attr">color</span>: <span class="number">0x645d50</span> &#125; );</span><br></pre></td></tr></table></figure>
<p>有了这两者，我们就可以构建一个长方体方块了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cube = <span class="keyword">new</span> THREE.Mesh( geometry, material );</span><br></pre></td></tr></table></figure>
<p>我们将其添加到场景中显示。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.add( cube );</span><br></pre></td></tr></table></figure>
<p>这样，一个三维的长方体就绘制完成了<br>关于其他形状的绘制，张雯莉的threejs入门指南中介绍的很详细，在此不多赘述。<br>这部分的完整代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-id">#canvasdiv</span>&#123;</span></span><br><span class="line"><span class="undefined">	width: 600px;</span></span><br><span class="line"><span class="undefined">	height: 600px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">	</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/three.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main-content"</span> <span class="attr">id</span>=<span class="string">"canvasdiv"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> &gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'canvasdiv'</span>)</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> scene = <span class="keyword">new</span> THREE.Scene();</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> width = canvasdiv.clientWidth;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> height = canvasdiv.clientHeight;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera( <span class="number">90</span>, width/height, <span class="number">0.1</span>, <span class="number">1000</span> );</span></span><br><span class="line"><span class="undefined">camera.position.set(0,0,10);</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> renderer = <span class="keyword">new</span> THREE.WebGLRenderer();</span></span><br><span class="line"><span class="undefined">renderer.setSize( width, height );</span></span><br><span class="line"><span class="undefined">canvasdiv.appendChild( renderer.domElement );</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> geometry = <span class="keyword">new</span> THREE.BoxGeometry( <span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span> );</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> material = <span class="keyword">new</span> THREE.MeshBasicMaterial( &#123; <span class="attr">color</span>: <span class="number">0x645d50</span> &#125; );</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> cube = <span class="keyword">new</span> THREE.Mesh( geometry, material );</span></span><br><span class="line"><span class="undefined">scene.add( cube );</span></span><br><span class="line"><span class="undefined">renderer.render(scene,camera);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>看上去它只是一个长方形而已，但是它确实是一个立体图形，你可以改变一下camera的位置来观察一下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">camera.position.set( 5,3,10 );</span><br></pre></td></tr></table></figure></p>
<p>好了，这样看起来是一个立体的长方体了吧。</p>
<h2 id="三、创建3d对象"><a href="#三、创建3d对象" class="headerlink" title="三、创建3d对象"></a>三、创建3d对象</h2><p>大多数时候，我们需要讲绘制的图形整合到一起进行控制。此时，我们便需要一个3d对象。</p>
<h3 id="创建一个自己的对象"><a href="#创建一个自己的对象" class="headerlink" title="创建一个自己的对象"></a>创建一个自己的对象</h3><p>在上面绘制的那个长方体上面再放一个球。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var geometry = new THREE.SphereGeometry( 0.5,100,100 );</span><br><span class="line">var material = new THREE.MeshBasicMaterial( &#123; color: 0xb9c16c &#125; );</span><br><span class="line">var ball = new THREE.Mesh( geometry,material );</span><br><span class="line">ball.position.set( 0,0,1 );</span><br><span class="line">scene.add(ball);</span><br></pre></td></tr></table></figure></p>
<p>另说一句，默认放置mesh的位置是( 0,0,0 )，和改变相机位置一样，我们可以用ball.position.set方法来改变图形或对象的位置。因此动画也利用这个方法来实现。<br>然后要把它们整合成一个对象。<br>首先我们创建一个对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myobj = <span class="keyword">new</span> THREE.Object3D();</span><br></pre></td></tr></table></figure>
<p>然后把我们画的图形添加到对象里就ok啦。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">myobj.add( cube );</span><br><span class="line">myobj.add( ball );</span><br></pre></td></tr></table></figure>
<p>这时候我们已经有了一个3d对象，它包含我们刚刚绘制的长方形和球。于是就没有必要像原来那样把图形一个一个地放置到场景里，只需要把刚刚创建的对象放置到场景里。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.add( myobj );</span><br></pre></td></tr></table></figure>
<p>完整代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-id">#canvasdiv</span>&#123;</span></span><br><span class="line"><span class="undefined">	width: 600px;</span></span><br><span class="line"><span class="undefined">	height: 600px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">	</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/three.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main-content"</span> <span class="attr">id</span>=<span class="string">"canvasdiv"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> &gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'canvasdiv'</span>)</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> scene = <span class="keyword">new</span> THREE.Scene();</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> width = canvasdiv.clientWidth;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> height = canvasdiv.clientHeight;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera( <span class="number">90</span>, width/height, <span class="number">0.1</span>, <span class="number">1000</span> );</span></span><br><span class="line"><span class="undefined">camera.position.set( 0,0,10 )</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> renderer = <span class="keyword">new</span> THREE.WebGLRenderer();</span></span><br><span class="line"><span class="undefined">renderer.setSize( width, height );</span></span><br><span class="line"><span class="undefined">canvasdiv.appendChild( renderer.domElement );</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> geometry = <span class="keyword">new</span> THREE.BoxGeometry( <span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span> );</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> material = <span class="keyword">new</span> THREE.MeshBasicMaterial( &#123; <span class="attr">color</span>: <span class="number">0x645d50</span> &#125; );</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> cube = <span class="keyword">new</span> THREE.Mesh( geometry, material );</span></span><br><span class="line"><span class="javascript"><span class="comment">//scene.add( cube );</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> geometry = <span class="keyword">new</span> THREE.SphereGeometry( <span class="number">0.5</span>,<span class="number">100</span>,<span class="number">100</span> );</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> material = <span class="keyword">new</span> THREE.MeshBasicMaterial( &#123; <span class="attr">color</span>: <span class="number">0xb9c16c</span> &#125; );</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> ball = <span class="keyword">new</span> THREE.Mesh( geometry,material );</span></span><br><span class="line"><span class="undefined">ball.position.set( 0,0,1 );</span></span><br><span class="line"><span class="javascript"><span class="comment">//scene.add(ball);</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> myobj = <span class="keyword">new</span> THREE.Object3D();</span></span><br><span class="line"><span class="undefined">myobj.add( cube );</span></span><br><span class="line"><span class="undefined">myobj.add( ball );</span></span><br><span class="line"><span class="undefined">scene.add( myobj );</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">renderer.render(scene,camera);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="外部导入-obj文件"><a href="#外部导入-obj文件" class="headerlink" title="外部导入.obj文件"></a>外部导入.obj文件</h3><p>threejs支持从外部导入.obj文件，听说这种文件是用3DsMax绘制的，用PS也可以编辑。我们需要引入OBJMTLLoader.js，MTLLoader.js文件；也有一个OBJLoader.js，但利用这个库只能导入模型而不能导入绘制obj时添加的材质，个人感觉不是非常实用，就不做介绍了。这时候，我们需要把文件们放到一个服务器上，否则会出现跨域问题。<br>为了让图像更明显，我们添加一些光线。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scene.add( <span class="keyword">new</span> THREE.AmbientLight( <span class="number">0xffffff</span> ) );</span><br></pre></td></tr></table></figure>
<p>这里，我们通过导入图片来设置这个对象的纹理。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> texture = <span class="keyword">new</span> THREE.Texture();</span><br><span class="line"><span class="keyword">var</span> loader = <span class="keyword">new</span> THREE.ImageLoader( );</span><br><span class="line">loader.load( <span class="string">'tank.jpg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"> image </span>) </span>&#123;</span><br><span class="line">	texture.image = image;</span><br><span class="line">	texture.needsUpdate = <span class="literal">true</span>;</span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure>
<p>开始导入我们的3D对象！</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> loader = <span class="keyword">new</span> THREE.OBJMTLLoader();  </span><br><span class="line">loader.load(<span class="string">'tank.obj'</span>,<span class="string">'tank.mtl'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">object</span>)</span>&#123;</span><br><span class="line">	tank = object;</span><br><span class="line"></span><br><span class="line">	object.traverse(<span class="function"><span class="keyword">function</span>(<span class="params">child</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (child <span class="keyword">instanceof</span> THREE.Mesh)&#123;</span><br><span class="line">        <span class="comment">//将贴图赋于材质</span></span><br><span class="line">            child.material.map = texture;</span><br><span class="line">            child.material.transparent = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    object.position.set(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    scene.add( object );  </span><br><span class="line">    camera.lookAt( object.position );</span><br><span class="line">	renderer.render( scene,camera );  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>模型导入进去了，但是看起来还是很奇怪，这就要我们加一些其他光线渲染一下。在这里我们添加平行光线。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> directionalLight = <span class="keyword">new</span> THREE.DirectionalLight( <span class="number">0xffffff</span>, <span class="number">1.5</span> );</span><br><span class="line">directionalLight.position.set( <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span> )</span><br><span class="line">scene.add( directionalLight );</span><br></pre></td></tr></table></figure>
<p>变得光泽多了。<br>从外部导入obj的完整代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-id">#canvasdiv</span>&#123;</span></span><br><span class="line"><span class="undefined">	width: 1200px;</span></span><br><span class="line"><span class="undefined">	height: 800px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">	</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/three.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/MTLLoader.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/OBJMTLLoader.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main-content"</span> <span class="attr">id</span>=<span class="string">"canvasdiv"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> &gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'canvasdiv'</span>)</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> scene = <span class="keyword">new</span> THREE.Scene();</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> width = canvasdiv.clientWidth;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> height = canvasdiv.clientHeight;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera( <span class="number">90</span>, width/height, <span class="number">0.1</span>, <span class="number">1000</span> );</span></span><br><span class="line"><span class="undefined">camera.position.set( -10,10,10);</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> renderer = <span class="keyword">new</span> THREE.WebGLRenderer();</span></span><br><span class="line"><span class="undefined">renderer.setSize( width, height );</span></span><br><span class="line"><span class="undefined">canvasdiv.appendChild( renderer.domElement );</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> texture = <span class="keyword">new</span> THREE.Texture();</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> loader = <span class="keyword">new</span> THREE.ImageLoader(  );</span></span><br><span class="line"><span class="javascript">loader.load( <span class="string">'tank.jpg'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"> image </span>) </span>&#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">	texture.image = image;</span></span><br><span class="line"><span class="javascript">	texture.needsUpdate = <span class="literal">true</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">&#125; );</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> loader = <span class="keyword">new</span> THREE.OBJMTLLoader();  </span></span><br><span class="line"><span class="javascript">loader.load(<span class="string">'tank.obj'</span>,<span class="string">'tank.mtl'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">object</span>)</span>&#123;</span></span><br><span class="line"><span class="undefined">	tank = object;</span></span><br><span class="line"><span class="javascript">	object.traverse(<span class="function"><span class="keyword">function</span>(<span class="params">child</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (child <span class="keyword">instanceof</span> THREE.Mesh)&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//将贴图赋于材质</span></span></span><br><span class="line"><span class="undefined">            child.material.map = texture;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//重点，没有该句会导致PNG无法正确显示透明效果</span></span></span><br><span class="line"><span class="javascript">            child.material.transparent = <span class="literal">true</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined">    object.position.set(0,0,0);</span></span><br><span class="line"><span class="undefined">    scene.add( object );  </span></span><br><span class="line"><span class="undefined">    camera.lookAt( object.position );</span></span><br><span class="line"><span class="undefined">	renderer.render( scene,camera );</span></span><br><span class="line"><span class="undefined">&#125;);  </span></span><br><span class="line"><span class="javascript">scene.add( <span class="keyword">new</span> THREE.AmbientLight( <span class="number">0xffffff</span> ) );</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> directionalLight = <span class="keyword">new</span> THREE.DirectionalLight( <span class="number">0xffffff</span>, <span class="number">1.5</span> );</span></span><br><span class="line"><span class="undefined">directionalLight.position.set( 1, 1, 1 )</span></span><br><span class="line"><span class="undefined">scene.add( directionalLight );</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">renderer.render(scene,camera);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="四、动画"><a href="#四、动画" class="headerlink" title="四、动画"></a>四、动画</h2><p>现在我们想办法让这些图形动起来。<br>在threejs中运用最多的动画是用requestAnimationFrame()方法。也可以利用传统的setInterval()做，但用这个会掉帧。<br>这里我们做一个render函数，来进行渲染和动画调用。这里以前面添加了myobj对象的代码为基础。</p>
<h3 id="基本的动画"><a href="#基本的动画" class="headerlink" title="基本的动画"></a>基本的动画</h3><p>现在来不断地改变对象的角度方便对其进行观察。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-id">#canvasdiv</span>&#123;</span></span><br><span class="line"><span class="undefined">	width: 600px;</span></span><br><span class="line"><span class="undefined">	height: 600px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">	</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/three.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main-content"</span> <span class="attr">id</span>=<span class="string">"canvasdiv"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> &gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> container,camera,scene,renderer,myobj;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> init = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">	container = <span class="built_in">document</span>.getElementById(<span class="string">'canvasdiv'</span>)</span></span><br><span class="line"><span class="javascript">	scene = <span class="keyword">new</span> THREE.Scene();</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> width = canvasdiv.clientWidth;</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> height = canvasdiv.clientHeight;</span></span><br><span class="line"><span class="javascript">	camera = <span class="keyword">new</span> THREE.PerspectiveCamera( <span class="number">90</span>, width/height, <span class="number">0.1</span>, <span class="number">1000</span> );</span></span><br><span class="line"><span class="undefined">	camera.position.set( 0,0,10 )</span></span><br><span class="line"><span class="javascript">	renderer = <span class="keyword">new</span> THREE.WebGLRenderer();</span></span><br><span class="line"><span class="undefined">	renderer.setSize( width, height );</span></span><br><span class="line"><span class="undefined">	canvasdiv.appendChild( renderer.domElement );</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> geometry = <span class="keyword">new</span> THREE.BoxGeometry( <span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span> );</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> material = <span class="keyword">new</span> THREE.MeshBasicMaterial( &#123; <span class="attr">color</span>: <span class="number">0x645d50</span> &#125; );</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> cube = <span class="keyword">new</span> THREE.Mesh( geometry, material );</span></span><br><span class="line"><span class="javascript">	<span class="comment">//scene.add( cube );</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> geometry = <span class="keyword">new</span> THREE.SphereGeometry( <span class="number">0.5</span>,<span class="number">100</span>,<span class="number">100</span> );</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> material = <span class="keyword">new</span> THREE.MeshBasicMaterial( &#123; <span class="attr">color</span>: <span class="number">0xb9c16c</span> &#125; );</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> ball = <span class="keyword">new</span> THREE.Mesh( geometry,material );</span></span><br><span class="line"><span class="undefined">	ball.position.set( 0,0,1 );</span></span><br><span class="line"><span class="javascript">	<span class="comment">//scene.add(ball);</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	myobj = <span class="keyword">new</span> THREE.Object3D();</span></span><br><span class="line"><span class="undefined">	myobj.add( cube );</span></span><br><span class="line"><span class="undefined">	myobj.add( ball );</span></span><br><span class="line"><span class="undefined">	scene.add( myobj );</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> render = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">	requestAnimationFrame( render );</span></span><br><span class="line"><span class="undefined">	myobj.rotation.x+=0.01;</span></span><br><span class="line"><span class="undefined">	myobj.rotation.y+=0.01;</span></span><br><span class="line"><span class="undefined">	renderer.render(scene,camera);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">init()</span></span><br><span class="line"><span class="undefined">render()</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="对动画进行控制"><a href="#对动画进行控制" class="headerlink" title="对动画进行控制"></a>对动画进行控制</h3><p>接着让我们对动画进行控制。<br>在我实现的项目中，是通过websocket连接后台传入参数来控制对象运动的，这里就介绍一下使用参数控制吧。<br>这里有一个问题，就是requestAnimationFrame回调的函数不能带有参数，否则会出现奇怪的bug。所以我选择用一个全局对象来进行控制。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> control=&#123;</span><br><span class="line">	s:<span class="number">0</span>,</span><br><span class="line">	p:<span class="number">0</span>,</span><br><span class="line">	q:<span class="number">0</span>,</span><br><span class="line">	j:<span class="number">0</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里s是运动的速度，p,q,j分别是myobj将要运动到的位置的x,y,z坐标。我们先写一个控制它在x轴上运动的函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> run = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ( myobj.position.x&lt;control.p ) &#123;</span><br><span class="line">		myobj.position.x += control.s;</span><br><span class="line">		requestAnimationFrame( run );</span><br><span class="line">		renderer.render( scene,camera )</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">if</span> ( myobj.position.x&gt;control.p ) &#123;</span><br><span class="line">		myobj.position.x -= control.s;</span><br><span class="line">		requestAnimationFrame( run );</span><br><span class="line">		renderer.render( scene,camera )</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再在render函数中添加对run的调用requestAnimationFrame( run )。这样就可以在命令行中改变对象control的值实现控制myobj的运动。但是在运动停止后我的浏览器为什么会变得很卡，而且运动速度回有变化。我还不知道原因。不知道有没有朋友和我有同样的问题。于是我把函数拆成了两个，这样浏览器性能好些。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> run = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ( myobj.position.x&lt;control.p ) &#123;</span><br><span class="line">		myobj.position.x += control.s;			</span><br><span class="line">		requestAnimationFrame( run );</span><br><span class="line">	&#125;;</span><br><span class="line">		renderer.render( scene,camera )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> runx = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ( myobj.position.x&gt;control.p ) &#123;</span><br><span class="line">	myobj.position.x -= control.s;			</span><br><span class="line">		requestAnimationFrame( runx );</span><br><span class="line">	&#125;;</span><br><span class="line">		renderer.render( scene,camera )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样的，也可以写出在y,z轴上运动的函数。<br>在x轴上运动的完整代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-id">#canvasdiv</span>&#123;</span></span><br><span class="line"><span class="undefined">	width: 600px;</span></span><br><span class="line"><span class="undefined">	height: 600px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">	</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/three.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main-content"</span> <span class="attr">id</span>=<span class="string">"canvasdiv"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> &gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> container,camera,scene,renderer,myobj;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> init = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">	container = <span class="built_in">document</span>.getElementById(<span class="string">'canvasdiv'</span>)</span></span><br><span class="line"><span class="javascript">	scene = <span class="keyword">new</span> THREE.Scene();</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> width = canvasdiv.clientWidth;</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> height = canvasdiv.clientHeight;</span></span><br><span class="line"><span class="javascript">	camera = <span class="keyword">new</span> THREE.PerspectiveCamera( <span class="number">90</span>, width/height, <span class="number">0.1</span>, <span class="number">1000</span> );</span></span><br><span class="line"><span class="undefined">	camera.position.set( 0,0,10 )</span></span><br><span class="line"><span class="javascript">	renderer = <span class="keyword">new</span> THREE.WebGLRenderer();</span></span><br><span class="line"><span class="undefined">	renderer.setSize( width, height );</span></span><br><span class="line"><span class="undefined">	canvasdiv.appendChild( renderer.domElement );</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> geometry = <span class="keyword">new</span> THREE.BoxGeometry( <span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span> );</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> material = <span class="keyword">new</span> THREE.MeshBasicMaterial( &#123; <span class="attr">color</span>: <span class="number">0x645d50</span> &#125; );</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> cube = <span class="keyword">new</span> THREE.Mesh( geometry, material );</span></span><br><span class="line"><span class="javascript">	<span class="comment">//scene.add( cube );</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> geometry = <span class="keyword">new</span> THREE.SphereGeometry( <span class="number">0.5</span>,<span class="number">100</span>,<span class="number">100</span> );</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> material = <span class="keyword">new</span> THREE.MeshBasicMaterial( &#123; <span class="attr">color</span>: <span class="number">0xb9c16c</span> &#125; );</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> ball = <span class="keyword">new</span> THREE.Mesh( geometry,material );</span></span><br><span class="line"><span class="undefined">	ball.position.set( 0,0,1 );</span></span><br><span class="line"><span class="javascript">	<span class="comment">//scene.add(ball);</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	myobj = <span class="keyword">new</span> THREE.Object3D();</span></span><br><span class="line"><span class="undefined">	myobj.add( cube );</span></span><br><span class="line"><span class="undefined">	myobj.add( ball );</span></span><br><span class="line"><span class="undefined">	scene.add( myobj );</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> control=&#123;</span></span><br><span class="line"><span class="undefined">	s:0,</span></span><br><span class="line"><span class="undefined">	p:0,</span></span><br><span class="line"><span class="undefined">	q:0,</span></span><br><span class="line"><span class="undefined">	j:0,</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> run = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="keyword">if</span> ( myobj.position.x&lt;control.p ) &#123;</span></span><br><span class="line"><span class="undefined">		myobj.position.x += control.s;			</span></span><br><span class="line"><span class="undefined">		requestAnimationFrame( run );</span></span><br><span class="line"><span class="undefined">	&#125;;</span></span><br><span class="line"><span class="undefined">		renderer.render( scene,camera )</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> runx = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="keyword">if</span> ( myobj.position.x&gt;control.p ) &#123;</span></span><br><span class="line"><span class="undefined">	myobj.position.x -= control.s;			</span></span><br><span class="line"><span class="undefined">		requestAnimationFrame( runx );</span></span><br><span class="line"><span class="undefined">	&#125;;</span></span><br><span class="line"><span class="undefined">		renderer.render( scene,camera )</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> render = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">	requestAnimationFrame( run );</span></span><br><span class="line"><span class="undefined">	requestAnimationFrame( runx );</span></span><br><span class="line"><span class="undefined">	renderer.render(scene,camera);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">init()</span></span><br><span class="line"><span class="undefined">render()</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个入门教程就到这里了，感谢阅读。</p>

      
    </div>
    <footer class="article-footer">
      <!-- <a data-url="http://rizzleci.github.io/2016/03/03/threejs-introduction/" data-id="ck912kj03002chb9ra4m7oile" class="article-share-link">Share</a> -->
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/threejs/">threejs</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/03/10/binary-tree-inJS/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          JS中的二叉树遍历
        
      </div>
    </a>
  
  
</nav>

  
</article>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/">html</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react-native/">react-native</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/threejs/">threejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网络/">网络</a></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 cxy<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/wwwwhat" class="mobile-nav-link">随笔</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
